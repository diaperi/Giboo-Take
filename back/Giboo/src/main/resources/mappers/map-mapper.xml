<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mapMapper">

	<!-- 지도 목록 조회 -->
	<resultMap type="map" id="map_rm">
		<id property="mapNo" column="MAP_NO"/>
		<result property="vagencyName" column="VAGENCY_NAME"/>
		<result property="volunteerPlace" column="VOLUNTEER_PLACE"/>
		<result property="categoryName" column="CATEGORY_NAME"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
		<result property="volunteerNo" column="VOLUNTEER_NO"/>
	</resultMap>
	
	<!-- 지도 목록 조회 -->
	<select id="selectMapList" resultMap="map_rm">
		SELECT 
		MAP_NO,
		VOLUNTEER_ATTACHEMENT, 
		PARENT_CATEGORY_NAME, 
		AGENCY_NAME, 
		VOLUNTEER_ADDR,
		A.VOLUNTEER_COUNT,
		R.REPLY_COUNT
		FROM MAP
		JOIN PARENT_CATEGORY USING(PARENT_CATEGORY_NO)
		JOIN AGENCY USING(AGENCY_NO)
		JOIN VOLUNTEER USING(VOLUNTEER_NO)
		JOIN DONATION USING(DONATION_NO)
		CROSS JOIN(SELECT COUNT(VOLUNTEER_NO) AS VOLUNTEER_COUNT FROM MYACTIVE) A
		CROSS JOIN(SELECT COUNT(REPLY_NO) AS REPLY_COUNT FROM REPLY) R;
	</select>
</mapper>
